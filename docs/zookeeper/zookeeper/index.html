<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="scroll-smooth" data-default-appearance="light"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-cn" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title> &middot; KV先生</title>
  <meta name="title" content=" &middot; KV先生" />
  
  
  
  
  
  <link rel="canonical" href="https://your_domain.com/docs/zookeeper/zookeeper/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.8ea60310059bae0843ca33ef1de0ed63f1367330a68d9b13d82d6c3bc474a4c1a7c705dba2592e367518d4eb2c0a82076592aeab874ff2e02034ddc7147c752f.css"
    integrity="sha512-jqYDEAWbrghDyjPvHeDtY/E2czCmjZsT2C1sO8R0pMGnxwXbolkuNnUY1OssCoIHZZKuq4dP8uAgNN3HFHx1Lw==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.b3e22525a7c62c7b8e4c7c002546ab6498031635fa2d07802d593d476d7ab1262ec61b0cec0fe9f5653e1c9e6c256cbd0b66e5a8421b4f82a7bd2c1d5c901638.js"
    integrity="sha512-s&#43;IlJafGLHuOTHwAJUarZJgDFjX6LQeALVk9R216sSYuxhsM7A/p9WU&#43;HJ5sJWy9C2blqEIbT4KnvSwdXJAWOA==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:url" content="https://your_domain.com/docs/zookeeper/zookeeper/">
  <meta property="og:site_name" content="KV先生">
  <meta property="og:title" content="KV先生">
  <meta property="og:description" content="Zookeeper # https://www.">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">

  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="KV先生">
  <meta name="twitter:description" content="Zookeeper # https://www.">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Docs",
    "name": "",
    "headline": "",
    
    "abstract": "Zookeeper # https:\/\/www.",
    "inLanguage": "zh-cn",
    "url" : "https:\/\/your_domain.com\/docs\/zookeeper\/zookeeper\/",
    "author" : {
      "@type": "Person",
      "name": "KV先生"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "629"
  }]
  </script>


  
  
  <meta name="author" content="KV先生" />
  
  
  
  <link href="mailto:hello@your_domain.com" rel="me" />
  
  
  <link href="https://github.com/bot-ruoshui" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  


  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">
	            <span style="font-weight:600;font-size:18px;">KV先生</span>
	        </a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/docs/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        文档
    </p>
</a>



            
            
  <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="">
        标签
    </p>
</a>



            
            
  <a href="https://github.com/5mrhelloworld"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <span >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
    
    <p class="text-base font-medium" title="">
        
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/docs/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            文档
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="/tags/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            标签
        </p>
    </a>
</li>




                    

                    
  <li class="mt-1">
    <a href="https://github.com/5mrhelloworld"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <div >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


        </div>
        
        <p class="text-bg font-bg" title="">
            
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>





  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >文章</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/docs/"
      >文章</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/docs/zookeeper/zookeeper/"
      >文章</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time><span class="px-2 text-primary-500">&middot;</span><span>629 字</span><span class="px-2 text-primary-500">&middot;</span><span title="预计阅读">3 分钟</span>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="KV先生" src="/img/wmz_hu0f64dbd4a3f6623dcafe1cf79b5f4bcf_435948_192x192_fill_q75_box_center.jpg" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      作者
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      KV先生
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">rosser</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:hello@your_domain.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/bot-ruoshui"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#集群和分布式">集群和分布式</a></li>
    <li><a href="#技术架构的演变">技术架构的演变</a>
      <ul>
        <li><a href="#单一应用架构">单一应用架构</a></li>
        <li><a href="#垂直应用架构">垂直应用架构</a></li>
        <li><a href="#soa面向服务架构">SOA面向服务架构</a></li>
        <li><a href="#微服务架构">微服务架构</a></li>
      </ul>
    </li>
    <li><a href="#cap原则">CAP原则</a>
      <ul>
        <li><a href="#定理">定理</a></li>
        <li><a href="#取舍策略">取舍策略</a>
          <ul>
            <li><a href="#ca">CA</a></li>
            <li><a href="#cp">CP</a></li>
            <li><a href="#ap">AP</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据的第一性">数据的第一性</a>
      <ul>
        <li><a href="#定义">定义</a></li>
        <li><a href="#模型">模型</a></li>
      </ul>
    </li>
    <li><a href="#paxos算法">Paxos算法</a>
      <ul>
        <li><a href="#简介">简介</a></li>
        <li><a href="#paxos判断">Paxos判断</a></li>
        <li><a href="#有主模式">有主模式</a></li>
      </ul>
    </li>
    <li><a href="#raft算法">Raft算法</a>
      <ul>
        <li><a href="#简介-1">简介</a></li>
        <li><a href="#角色分配">角色分配</a></li>
        <li><a href="#算法流程">算法流程</a></li>
      </ul>
    </li>
    <li><a href="#zab协议">ZAB协议</a>
      <ul>
        <li><a href="#简介-2">简介</a></li>
        <li><a href="#三种角色">三种角色</a>
          <ul>
            <li><a href="#leader">Leader</a></li>
            <li><a href="#follower">Follower</a></li>
            <li><a href="#observer">Observer</a></li>
          </ul>
        </li>
        <li><a href="#两种模式">两种模式</a>
          <ul>
            <li><a href="#崩溃恢复之数据恢复">崩溃恢复之数据恢复</a></li>
            <li><a href="#消息广播之原子广播">消息广播之原子广播</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
    <li><a href="#zookeeper集群搭建">Zookeeper集群搭建</a>
      <ul>
        <li><a href="#node01">Node01</a></li>
        <li><a href="#node0203">node02/03</a></li>
        <li><a href="#node010203">node01/02/03</a></li>
        <li><a href="#环境变量">环境变量</a></li>
      </ul>
    </li>
    <li><a href="#zookeeper监听机制">Zookeeper监听机制</a></li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#集群和分布式">集群和分布式</a></li>
    <li><a href="#技术架构的演变">技术架构的演变</a>
      <ul>
        <li><a href="#单一应用架构">单一应用架构</a></li>
        <li><a href="#垂直应用架构">垂直应用架构</a></li>
        <li><a href="#soa面向服务架构">SOA面向服务架构</a></li>
        <li><a href="#微服务架构">微服务架构</a></li>
      </ul>
    </li>
    <li><a href="#cap原则">CAP原则</a>
      <ul>
        <li><a href="#定理">定理</a></li>
        <li><a href="#取舍策略">取舍策略</a>
          <ul>
            <li><a href="#ca">CA</a></li>
            <li><a href="#cp">CP</a></li>
            <li><a href="#ap">AP</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#数据的第一性">数据的第一性</a>
      <ul>
        <li><a href="#定义">定义</a></li>
        <li><a href="#模型">模型</a></li>
      </ul>
    </li>
    <li><a href="#paxos算法">Paxos算法</a>
      <ul>
        <li><a href="#简介">简介</a></li>
        <li><a href="#paxos判断">Paxos判断</a></li>
        <li><a href="#有主模式">有主模式</a></li>
      </ul>
    </li>
    <li><a href="#raft算法">Raft算法</a>
      <ul>
        <li><a href="#简介-1">简介</a></li>
        <li><a href="#角色分配">角色分配</a></li>
        <li><a href="#算法流程">算法流程</a></li>
      </ul>
    </li>
    <li><a href="#zab协议">ZAB协议</a>
      <ul>
        <li><a href="#简介-2">简介</a></li>
        <li><a href="#三种角色">三种角色</a>
          <ul>
            <li><a href="#leader">Leader</a></li>
            <li><a href="#follower">Follower</a></li>
            <li><a href="#observer">Observer</a></li>
          </ul>
        </li>
        <li><a href="#两种模式">两种模式</a>
          <ul>
            <li><a href="#崩溃恢复之数据恢复">崩溃恢复之数据恢复</a></li>
            <li><a href="#消息广播之原子广播">消息广播之原子广播</a></li>
          </ul>
        </li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
    <li><a href="#zookeeper集群搭建">Zookeeper集群搭建</a>
      <ul>
        <li><a href="#node01">Node01</a></li>
        <li><a href="#node0203">node02/03</a></li>
        <li><a href="#node010203">node01/02/03</a></li>
        <li><a href="#环境变量">环境变量</a></li>
      </ul>
    </li>
    <li><a href="#zookeeper监听机制">Zookeeper监听机制</a></li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">Zookeeper 
    <div id="zookeeper" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#zookeeper" aria-label="锚点">#</a>
    </span>        
    
</h1>
<pre tabindex="0"><code>https://www.processon.com/view/link/64f1a21db08bb5658e7f6b05
</code></pre>

<h2 class="relative group">集群和分布式 
    <div id="%E9%9B%86%E7%BE%A4%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%9B%86%E7%BE%A4%E5%92%8C%E5%88%86%E5%B8%83%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>​	集群：建一个任务部署在多个服务器，每个服务器都能独立完成该任务。</p>
<p>​	分布式：将一个任务拆分成若干个子任务，每个服务器只能完成某个特定的子任务。</p>


<h2 class="relative group">技术架构的演变 
    <div id="%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84%E7%9A%84%E6%BC%94%E5%8F%98" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">单一应用架构 
    <div id="%E5%8D%95%E4%B8%80%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%8D%95%E4%B8%80%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>​	通俗的讲（monolith application）就是将应用程序的所有功能都打包成一个独立的单元。</p>
<pre tabindex="0"><code>特点：
所有的功能集成在一个项目工程中；
所有的功能打一个 war 包部署到服务器；
应用与数据库分开部署；
通过部署应用集群和数据库集群来提高系统的性能。

优点：
开发简单：一个 IDE 就可以快速构建单体应用；
便于共享：单个归档文件包含所有功能，便于在团队之间以及不同的部署阶段之间共享；
易于测试：单体应用一旦部署，所有的服务或特性就都可以使用了，这简化了测试过程，因为没有额外的依赖，每项测试都可以在部署完成后立刻开始；容易部署：整个项目就一个 war 包，Tomcat 安装好之后，应用扔上去就行了。群化部署也很容易，多个 Tomcat + 一个 Nginx 分分钟搞定。

缺点：
妨碍持续交付：随着时间的推移，单体应用可能会变得比较大，构建和部署时间也相应地延长，不利于频繁部署，阻碍持续交付。在移动应用开发中，这个问题会显得尤为严重；
不够灵活：随着项目的逐渐变大，整个开发流程的时间也会变得很长，即使在仅仅更改了一行代码的情况下，软件开发人员需要花费几十分钟甚至超过一个小时的时间对所有代码进行编译，并接下来花费大量的时间重新部署刚刚生成的产品，以验证自己的更改是否正确。如果多个开发人员共同开发一个应用程序，那么还要等待其他开发人员完成了各自的开发。这降低了团队的灵活性和功能交付频率；
受技术栈限制：项目变得越来越大的同时，我们的应用所使用的技术也会变得越来越多。这些技术有些是不兼容的，就比如在一个项目中大范围地混合使用 C++ 和 Java 几乎是不可能的事情。在这种情况下，我们就需要抛弃对某些不兼容技术的使用，而选择一种不是那么适合的技术来实现特定的功能；
可靠性差：某个环节出现了死循环，导致内存溢出，会影响整个项目挂掉；
伸缩性差：系统的扩容只能针对应用进行扩容，不能做到对某个功能进行扩容，扩容后必然带来资源浪费的问题；
技术债务：假设我的代码库中有一个混乱的模块结构。此时，我需要添加一个新功能。如果这个模块结构清晰，可能我只需要 2 天时间就可以添加好这个功能，但是如今这个模块的结构很混乱，所以我需要 4 天时间。多出来的这两天就是债务利息。随着时间推移、人员变动，技术债务必然也会随之增多。
</code></pre>

<h3 class="relative group">垂直应用架构 
    <div id="%E5%9E%82%E7%9B%B4%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%9E%82%E7%9B%B4%E5%BA%94%E7%94%A8%E6%9E%B6%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>​	当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。</p>
<pre tabindex="0"><code>特点：
以单体结构规模的项目为单位进行垂直划分，就是将一个大项目拆分成一个一个单体结构项目；
项目与项目之间存在数据冗余，耦合性较大，比如上图中三个项目都存在用户信息；
项目之间的接口多为数据同步功能，如：数据库之间的数据库，通过网络接口进行数据库同步。

优点：
开发成本低，架构简单；
避免单体应用的无限扩大；
系统拆分实现了流量分担，解决了并发问题；
可以针对不同系统进行扩容、优化；
方便水平扩展，负载均衡，容错率提高；
不同的项目可采用不同的技术；
系统间相互独立

缺点：
系统之间相互调用，如果某个系统的端口或者 IP 地址发生改变，调用系统需要手动变更；
垂直架构中相同逻辑代码需要不断的复制，不能复用；
系统性能扩展只能通过扩展集群结点，成本高、有瓶颈。
</code></pre>

<h3 class="relative group">SOA面向服务架构 
    <div id="soa%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#soa%E9%9D%A2%E5%90%91%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>​	当垂直应用越来越多，应用之间交互不可避免，将核心业务抽离出来，作为独立的服务，逐渐形成稳定的服务中心。当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需要添加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。</p>
<pre tabindex="0"><code>特点：
基于 SOA 的架构思想将重复公用的功能抽取为组件，以服务的形式给各系统提供服务；
各项目（系统）与服务之间采用 WebService、RPC 等方式进行通信；
使用 ESB 企业服务总线作为项目与服务之间通信的桥梁

优点：
将重复的功能抽取为服务，提高开发效率，提高系统的可重用性、可维护性；
可以针对不同服务的特点制定集群及优化方案；
采用 ESB 减少系统中的接口耦合。

缺点：
系统与服务的界限模糊，不利于开发及维护；
虽然使用了 ESB，但是服务的接口协议不固定，种类繁多，不利于系统维护；
抽取的服务的粒度过大，系统与服务之间耦合性高；
涉及多种中间件，对开发人员技术栈要求高；
服务关系复杂，运维、测试部署困难。
</code></pre>

<h3 class="relative group">微服务架构 
    <div id="%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>​	微服务就是讲一个单体架构的应用按业务划分为一个个的独立运行的程序集服务，他们之间通过HTTP协议进行通信，可以采用不同的编程化语言，使用不同的存储技术，自动化部署减少人为控制，降低出错率，服务数量越来越多，管理起来越来越复杂，因此采用集中化管理。</p>
<p>​	微服务是一种架构风格，架构是为了解耦，实际使用的是分布式系统开发。一个大型的复杂软件应用，有一个或多个微服务组成。系统中各个为服务可以被单独部署，各个微服务之间是松耦合的。每个微服务仅关注完成一件任务并很好地完成。</p>
<pre tabindex="0"><code>特点：
将系统服务层完全独立出来，并将服务层抽取为一个一个的微服务；
微服务中每一个服务都对应唯一的业务能力，遵循单一原则；
微服务之间采用 RESTful 等轻量协议传输。

优点：
团队独立：每个服务都是一个独立的开发团队，这个小团队可以是 2 到 5 人的开发人员组成；
技术独立：采用去中心化思想，服务之间采用 RESTful 等轻量协议通信，使用什么技术什么语言开发，别人无需干涉；
前后端分离：采用前后端分离开发，提供统一 Rest 接口，后端不用再为 PC、移动端开发不同接口；
数据库分离：每个微服务都有自己的存储能力，可以有自己的数据库。也可以有统一数据库；
服务拆分粒度更细，有利于资源重复利用，提高开发效率；
一个团队的新成员能够更快投入生产；
微服务易于被一个开发人员理解，修改和维护，这样小团队能够更关注自己的工作成果。无需通过合作才能体现价值；
可以更加精准的制定每个服务的优化方案（比如扩展），提高系统可维护性；
适用于互联网时代，产品迭代周期更短。

缺点：
微服务过多，服务治理成本高，不利于系统维护；
分布式系统开发的技术成本高（网络问题、容错问题、调用关系、分布式事务等），对团队挑战大；
微服务将原来的函数式调用改为服务调用，不管是用 rpc，还是 http rest 方式，都会增大系统整体延迟。这个是再所难免的，这个就需要我们将原来的串行编程改为并发编程甚至异步编程，增加了技术门槛；多服务运维难度，随着服务的增加，运维的压力也在增大；测试的难度提升。服务和服务之间通过接口来交互，当接口有改变的时候，对所有的调用方都是有影响的，这时自动化测试就显得非常重要了，如果要靠人工一个个接口去测试，那工作量就太大了，所以 API 文档的管理尤为重要。
</code></pre>

<h2 class="relative group">CAP原则 
    <div id="cap%E5%8E%9F%E5%88%99" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#cap%E5%8E%9F%E5%88%99" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">定理 
    <div id="%E5%AE%9A%E7%90%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AE%9A%E7%90%86" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>​	CAP原则又称CAP定理，指的是在一个分布式系统中，Consistency（一致性）、Availability（可用性）、Partition tolerance（分区容错性），三者不可兼得</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>定理</th>
</tr>
</thead>
<tbody>
<tr>
<td>Consistency</td>
<td>一致性：也叫做数据源原子性。在分布式系统中，更新操作执行成功后所有的用户访问的都是最新值，这样的系统被认为具有后强一致性，等同于所有节点访问同一份最新的数据。</td>
</tr>
<tr>
<td>Availability</td>
<td>可用性：每一个操作总是能够在一定的时间内返回及时结果，一定时间内是指在可以容忍的范围内返回结果，结果可以是成功或失败，且不保证获取的数据是最新数据。</td>
</tr>
<tr>
<td>Partition tolerance</td>
<td>分区容错性：分布式系统在遇到任何网络分区故障的时候，仍能够对外提供满足一致性和可用性的服务，除非整个网络环境瘫痪，理解为是否可以对数据进行分区考虑性能和伸缩性。</td>
</tr>
</tbody>
</table>


<h3 class="relative group">取舍策略 
    <div id="%E5%8F%96%E8%88%8D%E7%AD%96%E7%95%A5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%8F%96%E8%88%8D%E7%AD%96%E7%95%A5" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">CA 
    <div id="ca" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ca" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>舍弃P（不允许分区），则强一致性和可用性可以保证。分布式节点受限制，无法部署子节点。</p>


<h4 class="relative group">CP 
    <div id="cp" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#cp" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>舍弃A（可用），相当于每个请求都需要在服务器之间保持强一致性，强一致性会导致等待所有数据同步之后才能正常访问服务。即发生网络故障或信息丢失时，会牺牲用户体验，等待所有数据全部同步之后再让用户访问系统。对分布式数据库来说，数据一致性是最基本的要求，因为达不到这个标准，直接采用关系型数据库就好，没必要浪费资源部署分布式。</p>


<h4 class="relative group">AP 
    <div id="ap" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#ap" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>高可用并允许分区，放弃一致性。节点之间可能失去联系，为了高可用性，每个节点只能用本地数据提供服务，这样会导致全局数据的不一致性。先在A方面保证系统可以正常服务，然后在数据一致性方面做了牺牲。</p>


<h2 class="relative group">数据的第一性 
    <div id="%E6%95%B0%E6%8D%AE%E7%9A%84%E7%AC%AC%E4%B8%80%E6%80%A7" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E7%AC%AC%E4%B8%80%E6%80%A7" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">定义 
    <div id="%E5%AE%9A%E4%B9%89" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AE%9A%E4%B9%89" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>分布式系统通过复制数据来提高系统的可靠性和兼容性，将数据的不同副本存放在不同的机器中。</p>
<p>在数据有多副本的情况下，如果网络、服务器或者软件出现故障，会导致部分副本写入成功，部分失败。以至于副本之间数据不一致，数据内容出现冲突</p>


<h3 class="relative group">模型 
    <div id="%E6%A8%A1%E5%9E%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%A8%A1%E5%9E%8B" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>强一致性：要求无论更新操作是在哪一个副本执行，之后所有的读操作都要能获得最新的数据</p>
<p>弱一致性：用户读到某一操作对系统特定数据的更新需要一段时间，这段是时间是“不一致窗口”</p>
<p>最终一致性：弱一致性的特例，保证用户最终能够读取到某操作对系统特定数据的更新</p>
<p>​	从客户端看，可能暂时获取的数据不是最新数据，但是最终还是能访问到最新的</p>
<p>​	从服务端看，数据存储复制到整个系统超过半输的节点，保证数据最终一致</p>


<h2 class="relative group">Paxos算法 
    <div id="paxos%E7%AE%97%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#paxos%E7%AE%97%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">简介 
    <div id="%E7%AE%80%E4%BB%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AE%80%E4%BB%8B" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Paxos算法是Leslie Lamport宗师提出的一种基于消息传递的分布式一致性算法，使其获得2013年图灵奖。
Paxos在1990年提出，被广泛应用于分布式计算中，Google的Chubby，Apache的Zookeeper都是基于它的理论来实现的
Paxos算法解决的问题是分布式一致性问题，即一个分布式系统中的各个进程如何就某个值（决议）达成一致。
传统节点间通信存在着两种通讯模型：共享内存（Shared memory）、消息传递（Messages passing），Paxos是一个基于消息传递的一
致性算法。</p>


<h3 class="relative group">Paxos判断 
    <div id="paxos%E5%88%A4%E6%96%AD" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#paxos%E5%88%A4%E6%96%AD" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>小岛(Island) 服务器集群
议员(Senator) 单台服务器
议员的总数(Senator Count)是确定的
提议(Proposal) 每一次对集群中的数据进行修改
每个提议都有一个编号(PID)，这个编号是一直增长的
每个提议都需要超过半数((Senator Count)/2 +1)的议员同意才能生效
每个议员只会同意大于当前编号的提议
每个议员在自己记事本上面记录的编号，他不断更新这个编号
整个议会不能保证所有议员记事本上的编号总是相同的
议会有一个目标：保证所有的议员对于提议都能达成一致的看法。
前期投票(&gt;1/2)，后期广播(all)
Paxos算法
数据的全量备份
弱一致性 =&gt; 最终一致性</p>
<p>议员总数不能更改；事务变更需要通过一个提议Proposal，每个提议都有个不断增长的PID编号；超过半数议员同意才生效并广播；</p>


<h3 class="relative group">有主模式 
    <div id="%E6%9C%89%E4%B8%BB%E6%A8%A1%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%9C%89%E4%B8%BB%E6%A8%A1%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>​	集群初始化选主和宕机后重新选主</p>
<p>1、不能太慢，无脑投给编号最大的节点</p>
<p>2、主的数据一定是集群中最全的，不处于宕机状态（PID和公共相同且处于运行状态）</p>
<p>3、投票过半原则解决脑裂问题。</p>
<p>二阶段</p>
<p>1、询问：发起提议，询问大家是否都接受</p>
<p>2、广播阶段：询问阶段票数超总服务器过二分之一</p>
<p>主诞生以后</p>
<p>1、广播自己的数据至其他节点，解决其他节点数据落后的问题</p>
<p>2、公共朝代标记递增1</p>


<h2 class="relative group">Raft算法 
    <div id="raft%E7%AE%97%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#raft%E7%AE%97%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">简介 
    <div id="%E7%AE%80%E4%BB%8B-1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AE%80%E4%BB%8B-1" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Raft 适用于一个管理日志一致性的协议，相比于 Paxos 协议 Raft 更易于理解和去实现它。
Raft 将一致性算法分为了几个部分，包括领导选取（leader selection）、日志复制（log replication）、安全（safety）
Raft 算法的官网：https://raft.github.io/
中文版：https://acehi.github.io/thesecretlivesofdata-cn/raft/
英文版：http://thesecretlivesofdata.com/raft/</p>


<h3 class="relative group">角色分配 
    <div id="%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Raft算法将Server划分为3种状态，或者也可以称作角色：
Leader
负责Client交互和log复制，同一时刻系统中最多存在1个。
Follower
被动响应请求RPC，从不主动发起请求RPC。
Candidate
一种临时的角色，只存在于leader的选举阶段，某个节点想要变成leader，那么就发起投票请求，同时自己变		成candidate</p>


<h3 class="relative group">算法流程 
    <div id="%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B" aria-label="锚点">#</a>
    </span>        
    
</h3>
<pre tabindex="0"><code>Term
	Term的概念类比中国历史上的朝代更替，Raft 算法将时间划分成为任意不同长度的任期（term）。
	任期用连续的数字进行表示。每一个任期的开始都是一次选举（election），一个或多个候选人会试图成为领导人。如果一个候选人赢得了选举，它就会在该任期的剩余时间担任领导人。在某些情况下，选票会被瓜分，有可能没有选出领导人，那么，将会开始另一个任期，并且立刻开始下一次选举。Raft 算法保证在给定的一个任期最多只有一个领导人
	
RPC
	Raft 算法中服务器节点之间通信使用远程过程调用（RPCs）
	基本的一致性算法只需要两种类型的 RPCs，为了在服务器之间传输快照增加了第三种 RPC。
		RequestVote RPC：候选人在选举期间发起
		AppendEntries RPC：领导人发起的一种心跳机制，复制日志也在该命令中完成
		InstallSnapshot RPC: 领导者使用该RPC来发送快照给太落后的追随者
		
日志复制（Log Replication）
	主要用于保证节点的一致性，这阶段所做的操作也是为了保证一致性与高可用性。
	当Leader选举出来后便开始负责客户端的请求，所有事务（更新操作）请求都必须先经过Leader处理
	日志复制（Log Replication）就是为了保证执行相同的操作序列所做的工作。
	在Raft中当接收到客户端的日志（事务请求）后先把该日志追加到本地的Log中
	然后通过heartbeat把该Entry同步给其他Follower，Follower接收到日志后记录日志然后向Leader发送ACK
	当Leader收到大多数（n/2+1）Follower的ACK信息后将该日志设置为已提交并追加到本地磁盘中
	通知客户端并在下个heartbeat中Leader将通知所有的Follower将该日志存储在自己的本地磁盘中。
</code></pre>

<h2 class="relative group">ZAB协议 
    <div id="zab%E5%8D%8F%E8%AE%AE" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#zab%E5%8D%8F%E8%AE%AE" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">简介 
    <div id="%E7%AE%80%E4%BB%8B-2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%AE%80%E4%BB%8B-2" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>　ZAB 协议，全称 ZooKeeper Atomic Broadcast（ZooKeeper 原子广播协议）。它是专门为分布式协调服务——ZooKeeper 设计的一种支持崩溃恢复和原子广播的协议。</p>
<p>​	ZAB 协议借鉴了 Paxos 算法，而 ZooKeeper 正是通过 ZAB 协议来保证分布式事务的最终一致性。基于该协议，ZooKeeper 实现了一种主备模式的系统架构来保持集群中各个副本之间的数据一致性。</p>
<p>​	主备系统架构模型，就是指只有一个 Leader 节点负责处理外部的写事务请求，然后 Leader 节点将数据同步到其他 Follower 节点和Observer 节点。接下来我们详细介绍一下这三种角色。</p>


<h3 class="relative group">三种角色 
    <div id="%E4%B8%89%E7%A7%8D%E8%A7%92%E8%89%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%89%E7%A7%8D%E8%A7%92%E8%89%B2" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Follow 服务器和 Observer 服务器又统称为 Learner 服务器</p>


<h4 class="relative group">Leader 
    <div id="leader" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#leader" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>​	负责整个ZooKeeper集群工作机制中的核心，主要工作：实物请求的唯一调度和处理者，保证集群事务处理的顺序性，集群内部个服务器的调度者</p>


<h4 class="relative group">Follower 
    <div id="follower" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#follower" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>​	Leader的追随者，主要工作：处理客户端的非事务请求，转发事务请求给Leader服务器参与事务请求Proposal的投票，参与Leader选举投票</p>


<h4 class="relative group">Observer 
    <div id="observer" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#observer" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>​	不参与实物请求Proposal的 投票，也不参与Leader选举投票，只提供非事务的服务（查询），通常在不影响集群事务处理能力的前提下提升集群的非事务处理能力。</p>


<h3 class="relative group">两种模式 
    <div id="%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">崩溃恢复之数据恢复 
    <div id="%E5%B4%A9%E6%BA%83%E6%81%A2%E5%A4%8D%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%B4%A9%E6%BA%83%E6%81%A2%E5%A4%8D%E4%B9%8B%E6%95%B0%E6%8D%AE%E6%81%A2%E5%A4%8D" aria-label="锚点">#</a>
    </span>        
    
</h4>
<pre tabindex="0"><code>当整个集群正在启动时，或者当 Leader 节点出现网络中断、崩溃等情况时，ZAB 协议就会进入恢复模式并选举产生新的 Leader，当Leader 服务器选举出来后，并且集群中有过半的机器和该 Leader 节点完成数据同步后（同步指的是数据同步，用来保证集群中过半的机器能够和 Leader 服务器的数据状态保持一致），ZAB 协议就会退出恢复模式。

当集群中已经有过半的 Follower 节点完成了和 Leader 状态同步以后，那么整个集群就进入了消息广播模式。这个时候，在 Leader 节点正常工作时，启动一台新的服务器加入到集群，那这个服务器会直接进入数据恢复模式，和 Leader 节点进行数据同步。同步完成后即可正常对外提供非事务请求的处理。

在整个消息广播中，Leader 会将每一个事务请求转换成对应的 Proposal 来进行广播，并且在广播事务 Proposal 之前，Leader 服务器会首先为这个事务 Proposal 分配一个全局单递增的唯一ID，称之为事务 ID（即 ZXID），由于 ZAB 协议需要保证每一个消息的严格的顺序关系，因此必须将每一个 Proposal 按照其 ZXID 的先后顺序进行排序和处理
</code></pre>

<h4 class="relative group">消息广播之原子广播 
    <div id="%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD%E4%B9%8B%E5%8E%9F%E5%AD%90%E5%B9%BF%E6%92%AD" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%B6%88%E6%81%AF%E5%B9%BF%E6%92%AD%E4%B9%8B%E5%8E%9F%E5%AD%90%E5%B9%BF%E6%92%AD" aria-label="锚点">#</a>
    </span>        
    
</h4>
<pre tabindex="0"><code>在 ZooKeeper 集群中，数据副本的传递策略就是采用消息广播模式。Leader 服务器将客户端事务请求转化成一个 Prososal（提议），并将该 Proposal 分发给集群中所有的 Follower 服务器。也就是向所有 Follower 节点发送数据广播请求（或数据复制）。

ZooKeeper 中数据副本的同步方式与二段提交相似，但是却又不同。二段提交要求协调者必须等到所有的参与者全部反馈 ACK 确认消息后，再发送 Commit 消息。要求所有的参与者要么全部成功，要么全部失败。二段提交会产生严重的阻塞问题。

而在 ZAB 协议中 Leader 等待 Follower 的 ACK 反馈消息“只要半数以上的 Follower 成功反馈即可，不需要收到全部 Follower 的反馈”。
</code></pre>

<h3 class="relative group">总结 
    <div id="%E6%80%BB%E7%BB%93" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%80%BB%E7%BB%93" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>整个 ZAB 协议一共定义了三个阶段：
发现：要求 ZooKeeper 集群必须选举出一个 Leader，同时 Leader 会维护一个 Follower 可用列表。将来客户端可以和这些 Follower 节点进行通信。
同步：Leader 要负责将本身的数据与 Follower 完成同步，做到多副本存储。这样便体现了 CAP 中的一致性和分区容错。Follower 将队列中未处理完的请求消费完成后，写入本地事务日志中。
广播：Leader 可以接受客户端新的事务 Proposal 请求，将新的 Proposal 请求广播给所有的 Follower。</p>
<p>​	三个阶段执行完为一个周期，在 ZooKeeper 集群的整个生命周期中，这三个阶段会不断进行，如果 Leader 崩溃或因其它原因导致 Leader缺失，ZAB 协议会再次进入阶段一</p>


<h2 class="relative group">Zookeeper集群搭建 
    <div id="zookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#zookeeper%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">Node01 
    <div id="node01" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#node01" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>解压</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vim" data-lang="vim"><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="p">~</span>]# <span class="nx">tar</span> <span class="p">-</span><span class="nx">zxvf</span> <span class="nx">apache</span><span class="p">-</span><span class="nx">zookeeper</span><span class="m">-3</span>.<span class="m">6</span>.<span class="m">3</span><span class="p">-</span><span class="nx">bin</span>.<span class="nx">tar</span>.<span class="nx">gz</span> <span class="p">-</span><span class="nx">C</span> <span class="sr">/opt/</span><span class="nx">yjx</span>/
</span></span><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="p">~</span>]# <span class="nx">rm</span> <span class="nx">apache</span><span class="p">-</span><span class="nx">zookeeper</span><span class="m">-3</span>.<span class="m">6</span>.<span class="m">3</span><span class="p">-</span><span class="nx">bin</span>.<span class="nx">tar</span>.<span class="nx">gz</span> <span class="p">-</span><span class="nx">rf</span>
</span></span><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="p">~</span>]# <span class="nx">mkdir</span> <span class="p">-</span><span class="nx">p</span> <span class="sr">/var/</span><span class="nx">yjx</span><span class="sr">/zookeeper/</span><span class="nx">data</span>
</span></span><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="p">~</span>]# <span class="nx">mkdir</span> <span class="p">-</span><span class="nx">p</span> <span class="sr">/opt/</span><span class="nx">yjx</span><span class="sr">/apache-zookeeper-3.6.3-bin/</span><span class="nx">logs</span>
</span></span><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="p">~</span>]# <span class="nx">cd</span> <span class="sr">/opt/</span><span class="nx">yjx</span><span class="sr">/apache-zookeeper-3.6.3-bin/</span>
</span></span><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="nx">apache</span><span class="p">-</span><span class="nx">zookeeper</span><span class="m">-3</span>.<span class="m">6</span>.<span class="m">3</span><span class="p">-</span><span class="nx">bin</span>]# <span class="nx">cp</span> <span class="nx">conf</span><span class="sr">/zoo_sample.cfg conf/</span><span class="nx">zoo</span>.<span class="nx">cfg</span>
</span></span><span class="line"><span class="cl">[<span class="nx">root</span>@<span class="nx">node01</span> <span class="nx">apache</span><span class="p">-</span><span class="nx">zookeeper</span><span class="m">-3</span>.<span class="m">6</span>.<span class="m">3</span><span class="p">-</span><span class="nx">bin</span>]# <span class="nx">vim</span> <span class="nx">conf</span>/<span class="nx">zoo</span>.<span class="nx">cfg</span>
</span></span></code></pre></div><p>　创建数据目录、日志目录。</p>
<pre tabindex="0"><code>[root@node01 ~]# mkdir -p /var/yjx/zookeeper/data
[root@node01 ~]# mkdir -p /opt/yjx/apache-zookeeper-3.6.3-bin/logs
</code></pre><p>　修改配置文件，ZooKeeper 启动时默认加载的配置文件名为 zoo.cfg 。</p>
<pre tabindex="0"><code>[root@node01 ~]# cd /opt/yjx/apache-zookeeper-3.6.3-bin/
[root@node01 apache-zookeeper-3.6.3-bin]# cp conf/zoo_sample.cfg conf/zoo.cfg
[root@node01 apache-zookeeper-3.6.3-bin]# vim conf/zoo.cfg
</code></pre><p>主要修改以下内容（数字表示行号）：server.1 中的 1 是 myid 文件中的内容，2888 用于集群内部通信，3888 用于选举 Leader</p>
<pre tabindex="0"><code>12 dataDir=/var/yjx/zookeeper/data
13 dataLogDir=/opt/yjx/apache-zookeeper-3.6.3-bin/logs
15 clientPort=2181
37 server.1=node01:2888:3888
38 server.2=node02:2888:3888
39 server.3=node03:2888:3888
</code></pre>

<h3 class="relative group">node02/03 
    <div id="node0203" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#node0203" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>接下来将 node01 的 ZooKeeper 所有文件拷贝至 node02 和 node03。推荐从 node02 和 node03 拷贝</p>
<pre tabindex="0"><code>[root@node02 ~]# scp -r root@node01:/opt/yjx/apache-zookeeper-3.6.3-bin /opt/yjx/
[root@node03 ~]# scp -r root@node01:/opt/yjx/apache-zookeeper-3.6.3-bin /opt/yjx/
# 或者使用分发脚本
[root@node01 ~]# yjxrsync /opt/yjx/apache-zookeeper-3.6.3-bin
</code></pre>

<h3 class="relative group">node01/02/03 
    <div id="node010203" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#node010203" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>然后在三台机器的 /var/yjx/zookeeper/data 目录下分别创建 myid 文件，内容分别为 1，2，3</p>
<p>node01：</p>
<pre tabindex="0"><code>[root@node01 ~]# echo 1 &gt; /var/yjx/zookeeper/data/myid
</code></pre><p>node02：</p>
<pre tabindex="0"><code>[root@node02 ~]# mkdir -p /var/yjx/zookeeper/data
[root@node02 ~]# echo 2 &gt; /var/yjx/zookeeper/data/myid
</code></pre><p>node03：</p>
<pre tabindex="0"><code>[root@node03 ~]# mkdir -p /var/yjx/zookeeper/data
[root@node03 ~]# echo 3 &gt; /var/yjx/zookeeper/data/myid
</code></pre>

<h3 class="relative group">环境变量 
    <div id="%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>最后 vim /etc/profile 配置环境变量，环境搭建结束。</p>
<pre tabindex="0"><code>export ZOOKEEPER_HOME=/opt/yjx/apache-zookeeper-3.6.3-bin
export PATH=$ZOOKEEPER_HOME/bin:$PATH
</code></pre><p>配完环境变量后 source /etc/profile 重新加载环境变量。</p>


<h2 class="relative group">Zookeeper监听机制 
    <div id="zookeeper%E7%9B%91%E5%90%AC%E6%9C%BA%E5%88%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#zookeeper%E7%9B%91%E5%90%AC%E6%9C%BA%E5%88%B6" aria-label="锚点">#</a>
    </span>        
    
</h2>

        </div>
        
        

        
        

          
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_docs\\Zookeeper\\Zookeeper.md"
        var oid_likes = "likes_docs\\Zookeeper\\Zookeeper.md"
      </script>
      
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/docs/linux/linux/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  ></span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="返回顶部" title="返回顶部">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      KV先生
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> 强力驱动
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://your_domain.com/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="搜索"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="关闭 (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
